---
title: "How Houston’s Job Market Deviates From the Texas Norm"
output: html_document
date: "2025-06-03"
author: "Ava Hu"
---

### The Data
**1-Texas_OES_Report**: Based on the U.S. Bureau of Labor Statistics’ May 2024 Occupational Employment and Wage Statistics. I used statewide data across all sectors. Source: [BLS OES Research Estimates](https://www.bls.gov/oes/2024/may/oes_research_estimates.htm).

**2-Houston_OES_Report**: Derived from the May 2024 OES data published by the U.S. Bureau of Labor Statistics. I downloaded the data for the Houston-Pasadena-The Woodlands, TX metro area from the [Metropolitan and Nonmetropolitan Area Table](https://www.bls.gov/oes/2024/may/oessrcma.htm#T).


### Set Up

```{r}
library(tidyverse)
library(janitor)
library(readxl)
library(rvest)
```

### UPLOAD & CLEAN DATA

#### Houston OES Data

This dataset includes wage and employment information for each occupation in the Houston-The Woodlands-Sugar Land metropolitan area.

```{r}
houston_clean <- read_excel("../data/houston_OES_Report.xlsx", skip = 5) |> 
  clean_names() |> 
  mutate(
    soc_code = str_extract(occupation_soc_code, "\\d{2}-\\d{4}"),
    hourly_mean_houston = as.numeric(hourly_mean_wage),
    employment_houston = as.numeric(employment_1)
  ) |> 
  filter(!is.na(soc_code), !is.na(hourly_mean_houston), !is.na(employment_houston))

```

#### Texas OES Data

This dataset contains overall Texas occupational employment and wage estimates. We'll clean and align it to match the Houston dataset format.

To account for the fact that Texas OES data includes multiple entries per occupation across different industries (NAICS classifications), I grouped the dataset by SOC code. For each occupation, I calculated the average hourly wage across all industries and summed up the total employment. This aggregation provides a single representative wage and employment figure per occupation, allowing a clean, one-to-one comparison with the Houston dataset.

```{r}
texas <- read_csv("../data/texas_oes.csv") |> 
  clean_names() |> 
  mutate(
    soc_code = str_trim(occ_code)
  )

texas_clean <- texas |> 
  clean_names() |> 
  mutate(soc_code = str_trim(occ_code)) |> 
  group_by(soc_code) |> 
  summarise(
    hourly_mean_texas = mean(as.numeric(h_mean), na.rm = TRUE),
    employment_texas = sum(as.numeric(tot_emp), na.rm = TRUE),
    .groups = "drop"
  )
```

### MERGE & COMPARE
Join the two datasets by SOC code, then calculate wage gaps and prepare for analysis.

```{r}

wage_compare <- inner_join(
  houston_clean, texas_clean,
  by = "soc_code"
) |> 
  distinct(soc_code, .keep_all = TRUE)

```

Next, we filtered for occupations where workers in Houston earn less than their counterparts statewide. Then, we calculated the absolute wage gap and sorted the results to find the 10 largest gaps.


```{r}

top10_low_paid_high_employment <- wage_compare |> 
  filter(hourly_mean_houston < hourly_mean_texas) |> 
  mutate(
    wage_gap = hourly_mean_texas - hourly_mean_houston
  ) |> 
  arrange(desc(employment_houston)) |> 
  slice(1:10) |> 
  select(
    soc_code,
    occ_title = occupation_soc_code,
    hourly_mean_houston,
    hourly_mean_texas,
    wage_gap,
    employment_houston
  )

print(top10_low_paid_high_employment)


```

This time, we calculated the reverse: occupations where Houston pays more than the state average. Again, we ranked them by wage difference and kept the top 10.

```{r}
top10_houston_above_texas <- wage_compare |> 
  filter(hourly_mean_houston > hourly_mean_texas) |> 
  mutate(wage_gap = hourly_mean_houston - hourly_mean_texas) |> 
  arrange(desc(wage_gap)) |> 
  distinct(soc_code, .keep_all = TRUE) |>  
  slice(1:10) |> 
  select(
    soc_code,
    occ_title = occupation_soc_code,
    hourly_mean_houston,
    hourly_mean_texas,
    wage_gap,
    employment_houston,
    employment_texas
  )

print(top10_houston_above_texas)


```

### Findings

The top 10 underpaid jobs in Houston show relatively small wage differences, typically less than $3/hour, with the largest gap seen in sales and related occupations, where Houston workers earn about $7.36/hour less than their statewide counterparts. The rest of the list includes fast food workers, construction laborers, cashiers, stockers, and customer service representatives, all of whom experience minor pay disadvantages compared to the Texas average.

Occupations that earn significantly more in Houston are medical roles.At the top of the list are pathologists, who earn $135.66/hour in Houston—nearly $47/hour more than the statewide average. Other medical professions such as ophthalmologists, internal medicine physicians, dentists, and podiatrists also earn over $20/hour more in Houston than in Texas overall.

<iframe title="Top 10 Jobs Underpaid in Houston Compared to Texas" aria-label="Range Plot" id="datawrapper-chart-FVp3S" src="https://datawrapper.dwcdn.net/FVp3S/6/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="400" data-external="1"></iframe>

```{=html}
<script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r,i=0;r=e[i];i++)if(r.contentWindow===a.source){var d=a.data["datawrapper-height"][t]+"px";r.style.height=d}}}))}();
</script>
```

### Which Low-Wage Jobs Employ the Most People in Houston?

Beyond wage extremes, it's worth asking:
Which low-paid jobs in Houston employ the most people?

I filtered for occupations where Houston wages fall below the statewide average, then ranked by local employment. 

```{r}
top10_low_paid_high_employment <- wage_compare |> 
  filter(hourly_mean_houston < hourly_mean_texas) |> 
  mutate(
    wage_gap = hourly_mean_texas - hourly_mean_houston
  ) |> 
  arrange(desc(employment_houston)) |> 
  distinct(soc_code, .keep_all = TRUE) |> 
  slice(1:10) |> 
  select(
    soc_code,
    occ_title = occupation_soc_code,
    hourly_mean_houston,
    hourly_mean_texas,
    wage_gap,
    employment_houston
  )

print(top10_low_paid_high_employment)

```
The result highlights key sectors like education, construction, personal care, and retail—jobs that support the city’s infrastructure and everyday life, yet often offer relatively low pay. Nearly 196,000 people work in education in Houston, earning an average of $31.14 per hour, $15 below the statewide average.

<iframe title="Houston’s Most Common Low-Wage Jobs" aria-label="Table" id="datawrapper-chart-BfgTT" src="https://datawrapper.dwcdn.net/BfgTT/3/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="400" data-external="1"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"]){var e=document.querySelectorAll("iframe");for(var t in a.data["datawrapper-height"])for(var r,i=0;r=e[i];i++)if(r.contentWindow===a.source){var d=a.data["datawrapper-height"][t]+"px";r.style.height=d}}}))}();
</script>


### Top 10 occupations in Houston with higher wages than the Texas average but very low employment

I also looked for occupations where the average hourly wage in Houston is higher than the statewide average, then ranked them by local employment. From there, I selected the 10 least common roles. 

```{r}

top10_high_paid_low_employment <- wage_compare |> 
  filter(hourly_mean_houston > hourly_mean_texas) |> 
  mutate(
    wage_gap = hourly_mean_houston - hourly_mean_texas
  ) |> 
  arrange(employment_houston) |>  
  distinct(soc_code, .keep_all = TRUE) |> 
  slice(1:10) |> 
  select(
    soc_code,
    occ_title = occupation_soc_code,
    hourly_mean_houston,
    hourly_mean_texas,
    wage_gap,
    employment_houston
  )

print(top10_high_paid_low_employment)

```

Some of the best-paying opportunities in Houston are highly specialized and relatively rare. For instance, podiatrists in Houston earn nearly $111/hour, about $22 more than the statewide average, but only 70 people work in that area. 


## Trends

```{r}
# Set your data folder path
data_path <- "~/Documents/GitHub/ava-hu/data"

# Only load the 5 sector files
file_paths <- list.files(
  path = data_path,
  pattern = "^SeriesReport.*\\.xlsx$|^HoustonMining.*\\.xlsx$",
  full.names = TRUE
)

# Get sector name from metadata
get_sector_name <- function(file) {
  meta <- read_excel(file, range = "A8:B8", col_names = FALSE)
  sector <- meta[[2]]
  if (is.na(sector)) sector <- str_remove(basename(file), "\\.xlsx")
  return(sector)
}

# Extract and compute Jan–Dec average for each year
extract_annual_avg <- function(file) {
  df <- read_excel(file, skip = 12) |> 
    clean_names() |> 
    select(year, jan:dec) |> 
    filter(!is.na(year) & str_detect(as.character(year), "^\\d{4}")) |> 
    mutate(across(jan:dec, as.numeric)) |> 
    mutate(year = as.integer(year))

  df$annual_avg <- rowMeans(df[, c("jan", "feb", "mar", "apr", "may", "jun",
                                   "jul", "aug", "sep", "oct", "nov", "dec")],
                            na.rm = TRUE)

  df <- df |> 
    filter(year >= 2015, year <= 2024)

  sector <- get_sector_name(file)

  df |> 
    select(year, annual_avg) |> 
    pivot_wider(names_from = year, values_from = annual_avg) |> 
    mutate(Sector = sector) |> 
    select(Sector, everything())
}

# Run across all files
sector_avg_table <- bind_rows(lapply(file_paths, extract_annual_avg))

# View result
print(sector_avg_table)

```

```{r}

```



